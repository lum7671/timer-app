.PHONY: default clean build install test cli-build cli-install shell-install

# ê¸°ë³¸ íƒ€ê²Ÿ - GUI ì•± ë¹Œë“œ
default: clean build open

# GUI ì•± ê´€ë ¨ íƒ€ê²Ÿë“¤
clean:
	xcodebuild -quiet clean 

build: clean
	xcodebuild -quiet build CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO

open: build
	open ./build/Release/

# CLI ë²„ì „ ê´€ë ¨ íƒ€ê²Ÿë“¤
cli-build:
	@echo "ğŸ”¨ Swift CLI ë²„ì „ ë¹Œë“œ ì¤‘..."
	cd TimerCLI && swift build -c release
	@echo "âœ… CLI ë¹Œë“œ ì™„ë£Œ: TimerCLI/.build/release/TimerCLI"

cli-install: cli-build
	@echo "ğŸ“¦ CLI ë„êµ¬ ì„¤ì¹˜ ì¤‘..."
	sudo cp TimerCLI/.build/release/TimerCLI /usr/local/bin/timer
	@echo "âœ… CLI ì„¤ì¹˜ ì™„ë£Œ: /usr/local/bin/timer"
	@echo "ì‚¬ìš©ë²•: timer --time 14:30 --message \"íšŒì˜ ì‹œê°„\""

shell-install:
	@echo "ğŸ“¦ Shell ìŠ¤í¬ë¦½íŠ¸ ë²„ì „ ì„¤ì¹˜ ì¤‘..."
	chmod +x timer-simple.sh
	sudo cp timer-simple.sh /usr/local/bin/timer-shell
	@echo "âœ… Shell ìŠ¤í¬ë¦½íŠ¸ ì„¤ì¹˜ ì™„ë£Œ: /usr/local/bin/timer-shell"
	@echo "ì‚¬ìš©ë²•: timer-shell 14:30 \"íšŒì˜ ì‹œê°„\""

test: cli-build
	@echo "ğŸ§ª CLI ë„êµ¬ í…ŒìŠ¤íŠ¸ ì¤‘..."
	@echo "1ë¶„ í›„ í…ŒìŠ¤íŠ¸ ì•ŒëŒ:"
	TimerCLI/.build/release/TimerCLI --duration 1 --message "í…ŒìŠ¤íŠ¸ ì•ŒëŒì…ë‹ˆë‹¤!"

# ì „ì²´ ì„¤ì¹˜ (CLI + Shell)
install: cli-install shell-install
	@echo "ğŸ‰ ëª¨ë“  íƒ€ì´ë¨¸ ë„êµ¬ ì„¤ì¹˜ ì™„ë£Œ!"
	@echo ""
	@echo "ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:"
	@echo "  timer --time 14:30          # Swift CLI ë²„ì „"
	@echo "  timer-shell 14:30           # Shell ìŠ¤í¬ë¦½íŠ¸ ë²„ì „"
	@echo ""
	@echo "ë„ì›€ë§:"
	@echo "  timer --help"
	@echo "  timer-shell --help"

# ê°œë°œìš© - ë¹ ë¥¸ í…ŒìŠ¤íŠ¸
dev-test:
	cd TimerCLI && swift run TimerCLI --duration 1 --message "ê°œë°œ í…ŒìŠ¤íŠ¸" --verbose

# ì •ë¦¬
clean-all: clean
	@echo "ğŸ§¹ ì „ì²´ ì •ë¦¬ ì¤‘..."
	cd TimerCLI && swift package clean
	@echo "âœ… ì •ë¦¬ ì™„ë£Œ"

# ë„ì›€ë§
help:
	@echo "Timer App Makefile"
	@echo ""
	@echo "GUI ì•± ê´€ë ¨:"
	@echo "  make                # GUI ì•± ë¹Œë“œ ë° í´ë” ì—´ê¸°"
	@echo "  make build          # GUI ì•± ë¹Œë“œë§Œ"
	@echo "  make clean          # GUI ì•± ì •ë¦¬"
	@echo ""
	@echo "CLI ë„êµ¬ ê´€ë ¨:"
	@echo "  make cli-build      # Swift CLI ë¹Œë“œ"
	@echo "  make cli-install    # Swift CLI ì„¤ì¹˜"
	@echo "  make shell-install  # Shell ìŠ¤í¬ë¦½íŠ¸ ì„¤ì¹˜"
	@echo "  make install        # ëª¨ë“  CLI ë„êµ¬ ì„¤ì¹˜"
	@echo "  make test           # CLI ë„êµ¬ í…ŒìŠ¤íŠ¸"
	@echo "  make dev-test       # ê°œë°œìš© ë¹ ë¥¸ í…ŒìŠ¤íŠ¸"
	@echo ""
	@echo "ê¸°íƒ€:"
	@echo "  make clean-all      # ì „ì²´ ì •ë¦¬"
	@echo "  make help           # ì´ ë„ì›€ë§"
